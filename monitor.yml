---
- hosts: monitor
  become: yes
  remote_user: adminfpi
  tasks:
    - name: Add ElasticSearch Source
      lineinfile:
        path: /etc/apt/sources.list
        line: deb https://artifacts.elastic.co/packages/7.x/apt stable main
        create: yes

    - name: Install ElasticSearch Keys
      apt_key:
        url: https://artifacts.elastic.co/GPG-KEY-elasticsearch
        state: present

    - name: Install ElasticSearch
      apt:
        name:
          - elasticsearch
        state: present

    - name: Add ElasticSearch IP
      lineinfile:
        path: /etc/elasticsearch/elasticsearch.yml
        line: "network.host: 192.168.10.108"
        create: yes

    - name: Add ElasticSearch Port
      lineinfile:
        path: /etc/elasticsearch/elasticsearch.yml
        line: "http.port: 9200"
        create: yes

    - name: ensure ElasticSearch is running
      service:
        name: elasticsearch
        state: started
        enabled: true